<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#0A1628">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Lincoln Shuttle">
  <link rel="manifest" href="./manifest.json">
  <link rel="icon" href="./icon.svg" type="image/svg+xml">
  <title>Lincoln Shuttle Dispatch</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
    html, body { height: 100%; overflow-x: hidden; }
    body { font-family: system-ui, -apple-system, sans-serif; background: #EEF2F9; color: #2D3A52; font-size: 16px; }
    button { border: none; outline: none; cursor: pointer; background: none; font-family: inherit; -webkit-appearance: none; }
    input, select, textarea { font-family: inherit; font-size: 16px; outline: none; box-sizing: border-box; }
    select { -webkit-appearance: none; appearance: none; }
    @keyframes spin    { to { transform: rotate(360deg); } }
    @keyframes fadeIn  { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideUp { from { transform: translateY(24px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    @keyframes toastIn { from { transform: translateX(110%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    .spin { animation: spin 1s linear infinite; display: inline-block; }
  </style>
</head>
<body>
<div id="root"></div>

<script>
// â”€â”€â”€ Storage & Sync Module â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyirUHBboMV2t6svhFvgqhT0QTdVnswOyrJqjgx2luZD6WbXPW-1SOVnoBrwI6cVMC8/exec';

const Store = {
  get(key)      { try { const v = localStorage.getItem(key); return v ? JSON.parse(v) : null; } catch { return null; } },
  set(key, val) { try { localStorage.setItem(key, JSON.stringify(val)); } catch {} },
  del(key)      { localStorage.removeItem(key); },

  getCachedRides()   { return this.get('ls-rides') || []; },
  setCachedRides(r)  { this.set('ls-rides', r); },
  getSavedDrivers()  { return this.get('ls-drivers'); },
  setSavedDrivers(d) { this.set('ls-drivers', d); },
  hasPending()       { return this.get('ls-pending') === true; },
  setPending(v)      { v ? this.set('ls-pending', true) : this.del('ls-pending'); },

  async fetchRides(onStatus) {
    onStatus('syncing');
    try {
      const res  = await fetch(SCRIPT_URL + '?action=getRides&t=' + Date.now());
      const data = await res.json();
      const rides = data.rides || [];
      this.setCachedRides(rides);
      this.setPending(false);
      onStatus('synced');
      return rides;
    } catch {
      onStatus(navigator.onLine ? 'error' : 'offline');
      return this.getCachedRides();
    }
  },

  async saveRides(rides, onStatus) {
    this.setCachedRides(rides);
    onStatus('syncing');
    try {
      await fetch(SCRIPT_URL, {
        method: 'POST',
        body: JSON.stringify({ action: 'saveRides', rides })
      });
      this.setPending(false);
      onStatus('synced');
    } catch {
      this.setPending(true);
      onStatus(navigator.onLine ? 'error' : 'offline');
    }
  }
};
</script>

<script type="text/babel">
const { useState, useEffect, useRef } = React;

// â”€â”€â”€ Constants â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DEFAULT_DRIVERS = { active: ['Jeremy','Reggie','Gene','Eric'], archived: [] };
const EMPTY_FORM = { driver:'', date:'', time:'', pickup:'', dropoff:'', fare:'', charge:'', tip:'', details:'' };
const WEEK_START  = new Date('2026-01-04T12:00:00'); // earliest selectable history week

const toDateStr  = d => d.toISOString().slice(0,10);
const genId      = () => 'LS-' + Date.now().toString(36).toUpperCase();
const shiftDate  = (now = new Date()) => { const d = new Date(now); if (d.getHours() < 3) d.setDate(d.getDate()-1); return d; };
const fmt$       = n => { const v = parseFloat(n); return isNaN(v) ? '' : '$' + (v % 1 === 0 ? v.toFixed(0) : v.toFixed(2)); };

// â”€â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function weekBounds(anchorDate) {
  const sun = new Date(anchorDate);
  sun.setDate(anchorDate.getDate() - anchorDate.getDay());
  sun.setHours(0,0,0,0);
  const sat = new Date(sun);
  sat.setDate(sun.getDate() + 6);
  return { sun, sat, start: toDateStr(sun), end: toDateStr(sat),
    label: sun.toLocaleDateString('en-US',{month:'short',day:'numeric'}) + ' â€“ ' +
           sat.toLocaleDateString('en-US',{month:'short',day:'numeric'}) };
}

function buildDays(sunDate) {
  return Array.from({length:7}, (_,i) => {
    const d = new Date(sunDate); d.setDate(sunDate.getDate() + i);
    return {
      dateStr: toDateStr(d),
      label:   d.toLocaleDateString('en-US',{weekday:'long'}),
      short:   d.toLocaleDateString('en-US',{month:'short',day:'numeric'}),
      isToday: toDateStr(d) === toDateStr(shiftDate())
    };
  });
}

function allPastWeeks(currentSunDate) {
  const weeks = [];
  const d = new Date(WEEK_START);
  const limit = new Date(currentSunDate); limit.setHours(0,0,0,0);
  while (d < limit) {
    const sat = new Date(d); sat.setDate(d.getDate()+6);
    weeks.push({
      sunStr: toDateStr(d),
      label: d.toLocaleDateString('en-US',{month:'short',day:'numeric'}) + ' â€“ ' +
             sat.toLocaleDateString('en-US',{month:'short',day:'numeric'})
    });
    d.setDate(d.getDate()+7);
  }
  return weeks.reverse();
}

// â”€â”€â”€ Sub-components â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function SyncDot({ status }) {
  const map = {
    synced:  { color:'#6EE7B7', spin:false },
    syncing: { color:'#93B8F0', spin:true  },
    offline: { color:'#FCD34D', spin:false },
    error:   { color:'#FCA5A5', spin:false },
    loading: { color:'#93B8F0', spin:true  },
  };
  const s = map[status] || map.error;
  return <span className={s.spin ? 'spin' : ''} style={{display:'inline-block',width:8,height:8,borderRadius:'50%',background:s.color}}/>;
}

// â”€â”€â”€ Main App â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function App() {
  const today        = shiftDate();
  const currentWeek  = weekBounds(today);

  // Core data
  const [rides,        setRides]        = useState([]);
  const [drivers,      setDrivers]      = useState(DEFAULT_DRIVERS);
  const [ready,        setReady]        = useState(false);   // true once loaded from sheet/cache
  const [syncStatus,   setSyncStatus]   = useState('loading');

  // UI state
  const [showModal,    setShowModal]    = useState(false);
  const [editId,       setEditId]       = useState(null);
  const [form,         setForm]         = useState(EMPTY_FORM);
  const [showExtra,    setShowExtra]    = useState(false);   // expand form in new-ride mode
  const [delConfirm,   setDelConfirm]   = useState(null);
  const [showDrivers,  setShowDrivers]  = useState(false);
  const [newName,      setNewName]      = useState('');
  const [toast,        setToast]        = useState(null);
  const [listening,    setListening]    = useState(false);
  const [voiceResult,  setVoiceResult]  = useState(null);

  // Stats / history UI
  const [statsDriver,   setStatsDriver]   = useState(DEFAULT_DRIVERS.active[0]);
  const [rollingDriver, setRollingDriver] = useState(DEFAULT_DRIVERS.active[0]);
  const [rollingOpen,   setRollingOpen]   = useState(false);
  const [openDays,      setOpenDays]      = useState({ [toDateStr(today)]: true });
  const [histOpen,      setHistOpen]      = useState(false);
  const [histDriver,    setHistDriver]    = useState(DEFAULT_DRIVERS.active[0]);
  const [histRolDriver, setHistRolDriver] = useState(DEFAULT_DRIVERS.active[0]);
  const [histRolOpen,   setHistRolOpen]   = useState(false);
  const [histOpenDays,  setHistOpenDays]  = useState({});
  const [histWeekStr,   setHistWeekStr]   = useState(() => {
    const d = shiftDate();
    const s = new Date(d); s.setDate(d.getDate() - d.getDay() - 7);
    return toDateStr(s);
  });

  const recRef = useRef(null);

  // â”€â”€ Load on mount â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  useEffect(() => {
    const isPreview = location.hostname.includes('claudeusercontent.com') ||
                      location.hostname === 'localhost' || location.hostname === '127.0.0.1';
    if ('serviceWorker' in navigator && !isPreview) {
      navigator.serviceWorker.register('./sw.js').catch(()=>{});
    }

    Store.fetchRides(setSyncStatus).then(fetched => {
      setRides(fetched && fetched.length > 0 ? fetched : Store.getCachedRides());
      setReady(true);
    });

    const saved = Store.getSavedDrivers();
    if (saved) setDrivers(saved);

    const handleOnline = () => {
      if (Store.hasPending()) {
        Store.saveRides(Store.getCachedRides(), setSyncStatus);
      }
    };
    window.addEventListener('online', handleOnline);
    return () => window.removeEventListener('online', handleOnline);
  }, []);

  // â”€â”€ Data helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function doSaveRides(updated) {
    if (!ready) return;
    setRides(updated);
    await Store.saveRides(updated, setSyncStatus);
  }

  function doSaveDrivers(updated) {
    setDrivers(updated);
    Store.setSavedDrivers(updated);
  }

  async function doRefresh() {
    const fetched = await Store.fetchRides(setSyncStatus);
    if (fetched) setRides(fetched);
  }

  // â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function toast$(msg) { setToast(msg); setTimeout(()=>setToast(null), 2800); }

  // â”€â”€ Modal helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function openNew() {
    const now = new Date();
    const hh  = String(now.getHours()).padStart(2,'0');
    const mm  = String(now.getMinutes()).padStart(2,'0');
    setEditId(null);
    setShowExtra(false);
    setForm({ ...EMPTY_FORM, date: toDateStr(shiftDate(now)), time: `${hh}:${mm}` });
    setShowModal(true);
  }

  function openEdit(ride) {
    setEditId(ride.id);
    setForm({ ...ride });
    setShowModal(true);
  }

  async function handleSave() {
    if (!form.pickup.trim()) return;
    if (editId) {
      await doSaveRides(rides.map(r => r.id === editId ? { ...form, id: editId } : r));
      toast$('Ride updated.');
    } else {
      await doSaveRides([{ ...form, id: genId() }, ...rides]);
      toast$('Ride booked.');
    }
    setShowModal(false);
  }

  async function handleDelete(id) {
    await doSaveRides(rides.filter(r => r.id !== id));
    setDelConfirm(null);
    toast$('Ride removed.');
  }

  // â”€â”€ Voice â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function startVoice() {
    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!SR) { toast$('Voice not supported â€” use Chrome.'); return; }
    if (listening) return;
    const rec = new SR();
    rec.lang = 'en-US'; rec.interimResults = false;
    recRef.current = rec;
    setListening(true);
    rec.onresult = e => {
      const text = e.results[0][0].transcript;
      const now  = new Date();
      setVoiceResult({ text, date: toDateStr(shiftDate(now)), time: String(now.getHours()).padStart(2,'0')+':'+String(now.getMinutes()).padStart(2,'0') });
      setListening(false);
    };
    rec.onerror = () => { setListening(false); toast$("Couldn't hear that â€” try again."); };
    rec.onend   = () => setListening(false);
    rec.start();
  }

  async function confirmVoice() {
    await doSaveRides([{ ...EMPTY_FORM, id: genId(), pickup: voiceResult.text, date: voiceResult.date, time: voiceResult.time }, ...rides]);
    setVoiceResult(null);
    toast$('Ride booked.');
  }

  // â”€â”€ Driver management â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function addDriver() {
    const name = newName.trim();
    if (!name) return;
    if (drivers.active.includes(name) || drivers.archived.includes(name)) { toast$('Driver already exists.'); return; }
    doSaveDrivers({ ...drivers, active: [...drivers.active, name] });
    setNewName('');
    toast$('Added: ' + name);
  }

  function archiveDriver(name) {
    doSaveDrivers({ active: drivers.active.filter(n=>n!==name), archived: [...drivers.archived, name] });
  }

  function restoreDriver(name) {
    doSaveDrivers({ active: [...drivers.active, name], archived: drivers.archived.filter(n=>n!==name) });
  }

  // â”€â”€ Computed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const curDays  = buildDays(currentWeek.sun);
  const curRides = rides.filter(r => r.date >= currentWeek.start && r.date <= currentWeek.end);

  const stats = (rideList, driver) => {
    const dr = rideList.filter(r => r.driver === driver);
    return {
      fare:   dr.reduce((a,r)=>a+(parseFloat(r.fare)||0),0),
      charge: dr.reduce((a,r)=>a+(parseFloat(r.charge)||0),0),
      tip:    dr.reduce((a,r)=>a+(parseFloat(r.tip)||0),0),
    };
  };

  const curStats = stats(curRides, statsDriver);

  const histWeek  = weekBounds(new Date(histWeekStr + 'T12:00:00'));
  const histDays  = buildDays(histWeek.sun);
  const histRides = rides.filter(r => r.date >= histWeek.start && r.date <= histWeek.end);
  const histStats = stats(histRides, histDriver);

  const pastWeeks = allPastWeeks(currentWeek.sun);

  // â”€â”€ Styles â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const S = {
    input: { width:'100%', border:'1.5px solid #D1DEFA', borderRadius:8, padding:'11px 14px', fontSize:16, background:'#F9FBFF', color:'#0A1628' },
    label: { display:'block', fontSize:11, fontWeight:700, color:'#6B87B0', letterSpacing:.8, marginBottom:5, textTransform:'uppercase' },
    btn:   (bg, color, extra={}) => ({ background:bg, color, borderRadius:10, padding:'13px', fontSize:15, fontWeight:600, border:'none', cursor:'pointer', minHeight:48, ...extra }),
  };

  // â”€â”€ Sub-components (inside App for closure access) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  function DriverPill({ value, onChange, light }) {
    return (
      <div style={{position:'relative',display:'inline-flex',alignItems:'center',maxWidth:150}}>
        <select value={value} onChange={e=>onChange(e.target.value)}
          style={{border:light?'none':'1.5px solid #D1DEFA',borderRadius:6,padding:'4px 22px 4px 8px',fontSize:11,
                  color:value?'#0A1628':'#9FB4D0',cursor:'pointer',background:light?'#fff':'#F5F8FF',width:'100%'}}>
          <option value=''>Unassigned</option>
          {drivers.active.map(d=><option key={d}>{d}</option>)}
        </select>
        <span style={{position:'absolute',right:5,pointerEvents:'none',fontSize:9,color:'#1E4D8C'}}>â–¼</span>
      </div>
    );
  }

  function StatCards({ s }) {
    return (
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:8,marginBottom:10}}>
        {[['Fares','ğŸ§¾',s.fare],['Charges','ğŸ’³',s.charge],['Tips','ğŸ’°',s.tip]].map(([label,icon,val])=>(
          <div key={label} style={{background:'#fff',borderRadius:10,padding:'10px 8px',boxShadow:'0 1px 4px rgba(30,77,140,.08)',borderTop:'3px solid #1E4D8C',textAlign:'center'}}>
            <div style={{fontSize:18,marginBottom:3}}>{icon}</div>
            <div style={{fontSize:9,fontWeight:700,color:'#6B87B0',textTransform:'uppercase',letterSpacing:.5,marginBottom:4}}>{label}</div>
            <div style={{fontSize:18,fontWeight:700,color:'#0A1628',lineHeight:1}}>${val.toFixed(2)}</div>
          </div>
        ))}
      </div>
    );
  }

  function RideRow({ ride, i }) {
    const fareStr = fmt$(ride.fare);
    const bg0 = i%2===0 ? '#fff' : '#F8FAFF';
    return (
      <tr style={{background:bg0,borderBottom:'1px solid #EBF0FA',cursor:'pointer'}}
        onClick={()=>openEdit(ride)}
        onMouseEnter={e=>e.currentTarget.style.background='#EEF6FF'}
        onMouseLeave={e=>e.currentTarget.style.background=bg0}>
        <td style={{padding:'10px 16px 10px 12px',width:'100%'}}>
          <div style={{display:'flex',alignItems:'flex-start',gap:10}}>
            <div style={{flex:1,minWidth:0,display:'flex',flexDirection:'column',gap:3}}>
              <div style={{fontWeight:700,fontSize:13,color:'#1E4D8C'}}>
                {ride.driver || <span style={{color:'#C0CCDE',fontStyle:'italic',fontWeight:400}}>Unassigned</span>}
                {ride.time && <span style={{fontWeight:400,color:'#9FB4D0',fontSize:11,marginLeft:6}}>{ride.time}</span>}
              </div>
              <div style={{fontSize:13,color:'#2D3A52',overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'}}>
                {ride.pickup||'â€”'}
                {ride.dropoff && <><span style={{color:'#93B8F0'}}> â†’ </span>{ride.dropoff}</>}
              </div>
              {(ride.fare||ride.charge) && (
                <div style={{fontSize:12,fontWeight:700,color:'#065F46'}}>
                  {ride.fare && <span>{fareStr}</span>}
                  {ride.charge && <span style={{marginLeft:ride.fare?6:0}}>Charge {fmt$(ride.charge)}</span>}
                  {ride.tip && parseFloat(ride.tip)>0 && <span style={{marginLeft:6,color:'#B45309'}}>Tip {fmt$(ride.tip)}</span>}
                </div>
              )}
              {ride.details && <div style={{fontSize:11,color:'#9FB4D0',fontStyle:'italic',overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'}}>{ride.details}</div>}
            </div>
            <button onClick={e=>{e.stopPropagation();setDelConfirm(ride.id);}}
              style={{background:'#FEF2F2',color:'#991B1B',borderRadius:6,padding:'6px 10px',fontSize:11,fontWeight:600,flexShrink:0,minHeight:32,whiteSpace:'nowrap',border:'none'}}>
              Del
            </button>
          </div>
        </td>
      </tr>
    );
  }

  function DaySection({ day, dayRides, isOpen, onToggle }) {
    return (
      <div style={{background:'#fff',borderRadius:10,overflow:'hidden',
                   boxShadow:'0 1px 6px rgba(30,77,140,.08)',
                   border:day.isToday?'2px solid #1E4D8C':'2px solid transparent'}}>
        <div onClick={onToggle} style={{cursor:'pointer',minHeight:44,padding:'10px 14px',
          background:day.isToday?'linear-gradient(135deg,#0A1628,#1E4D8C)':'linear-gradient(135deg,#2D3A52,#4A6A9C)',
          display:'flex',alignItems:'center',justifyContent:'space-between'}}>
          <div style={{display:'flex',alignItems:'center',gap:7,minWidth:0,overflow:'hidden'}}>
            <span style={{fontWeight:700,fontSize:13,color:'#fff',flexShrink:0}}>{day.label.toUpperCase()}</span>
            <span style={{fontSize:11,color:'rgba(255,255,255,.65)',flexShrink:0}}>{day.short}</span>
            {day.isToday && <span style={{background:'rgba(255,255,255,.25)',color:'#fff',fontSize:9,fontWeight:700,padding:'2px 7px',borderRadius:8,flexShrink:0}}>TODAY</span>}
          </div>
          <span style={{fontSize:11,color:'rgba(255,255,255,.75)',fontWeight:600,flexShrink:0,marginLeft:8}}>
            {dayRides.length} ride{dayRides.length!==1?'s':''}
          </span>
        </div>
        {isOpen && (dayRides.length === 0
          ? <div style={{padding:'12px 14px',fontSize:13,color:'#C0CCDE',fontStyle:'italic'}}>No rides</div>
          : <table style={{width:'100%',borderCollapse:'collapse',tableLayout:'fixed'}}>
              <tbody>{dayRides.map((r,i)=><RideRow key={r.id} ride={r} i={i}/>)}</tbody>
            </table>
        )}
      </div>
    );
  }

  function RollingTable({ days, driver }) {
    let running = 0;
    return (
      <table style={{width:'100%',borderCollapse:'collapse',fontSize:12}}>
        <thead><tr style={{background:'#F0F4FB'}}>
          {['Day','Day Fares','Running'].map(h=>(
            <th key={h} style={{padding:'6px 12px',textAlign:h==='Day'?'left':'right',fontSize:10,fontWeight:700,color:'#6B87B0',textTransform:'uppercase',letterSpacing:.8}}>{h}</th>
          ))}
        </tr></thead>
        <tbody>
          {days.map((day,i) => {
            const df = rides.filter(r=>r.date===day.dateStr&&r.driver===driver).reduce((a,r)=>a+(parseFloat(r.fare)||0),0);
            running += df;
            return (
              <tr key={day.dateStr} style={{borderBottom:'1px solid #EBF0FA',background:day.isToday?'#EBF2FF':i%2===0?'#fff':'#F8FAFF'}}>
                <td style={{padding:'6px 12px',color:day.isToday?'#1E4D8C':'#2D3A52',fontWeight:day.isToday?700:400}}>
                  {day.label} <span style={{color:'#9FB4D0',fontSize:10}}>{day.short}</span>
                </td>
                <td style={{padding:'6px 12px',textAlign:'right',color:df>0?'#0A1628':'#C0CCDE',fontWeight:df>0?600:400}}>{df>0?'$'+df.toFixed(2):'â€”'}</td>
                <td style={{padding:'6px 12px',textAlign:'right',fontWeight:700,color:running>0?'#065F46':'#C0CCDE'}}>{running>0?'$'+running.toFixed(2):'â€”'}</td>
              </tr>
            );
          })}
        </tbody>
      </table>
    );
  }

  // â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if (!ready) return (
    <div style={{minHeight:'100vh',background:'#EEF2F9',display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',gap:16}}>
      <div style={{width:40,height:40,borderRadius:'50%',border:'3px solid #D1DEFA',borderTopColor:'#1E4D8C',animation:'spin 1s linear infinite'}}/>
      <div style={{fontSize:13,color:'#6B87B0',letterSpacing:1}}>LOADING FROM SHEETSâ€¦</div>
    </div>
  );

  return (
    <div style={{minHeight:'100vh',background:'#EEF2F9',overflowX:'hidden'}}>

      {/* â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
      <div style={{background:'linear-gradient(135deg,#0A1628,#1E4D8C)',padding:'8px 12px',
                   display:'flex',alignItems:'center',justifyContent:'space-between',
                   minHeight:56,boxShadow:'0 2px 12px rgba(10,22,40,.35)',position:'sticky',top:0,zIndex:100}}>

        {/* Logo */}
        <div style={{display:'flex',alignItems:'center',gap:8,flex:1,minWidth:0}}>
          <div style={{background:'#fff',borderRadius:6,width:34,height:34,display:'flex',alignItems:'center',justifyContent:'center',flexShrink:0}}>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M3 17h2a2 2 0 004 0h6a2 2 0 004 0h2V9l-3-5H6L3 9v8z" fill="#1E4D8C"/>
              <circle cx="7" cy="17" r="1.5" fill="white"/>
              <circle cx="17" cy="17" r="1.5" fill="white"/>
              <path d="M3 13h18" stroke="white" strokeWidth="1.2"/>
            </svg>
          </div>
          <div style={{minWidth:0}}>
            <div style={{fontSize:13,fontWeight:700,color:'#fff',letterSpacing:1.5,lineHeight:1}}>LINCOLN SHUTTLE</div>
            <div style={{display:'flex',alignItems:'center',gap:5,marginTop:2}}>
              <div style={{fontSize:8,color:'#93B8F0',letterSpacing:1}}>DISPATCH</div>
              <SyncDot status={syncStatus}/>
            </div>
          </div>
        </div>

        {/* Actions */}
        <div style={{display:'flex',alignItems:'center',gap:6,flexShrink:0}}>
          <button onClick={()=>setShowDrivers(true)}
            style={{background:'rgba(255,255,255,.15)',color:'#fff',border:'1px solid rgba(255,255,255,.3)',borderRadius:8,padding:'8px 12px',fontWeight:700,fontSize:12,minHeight:36}}>
            DRIVERS
          </button>
          <button onClick={doRefresh} title="Sync from Sheets"
            style={{color:'rgba(255,255,255,.85)',fontSize:20,padding:'6px 8px',borderRadius:8,minHeight:36,display:'flex',alignItems:'center',justifyContent:'center',lineHeight:1}}>
            â†»
          </button>
          <button onClick={startVoice}
            style={{width:42,height:42,borderRadius:'50%',border:'none',flexShrink:0,
                    background:listening?'#E53E3E':'#fff',
                    boxShadow:listening?'0 0 0 4px rgba(229,62,62,.35)':'0 2px 8px rgba(0,0,0,.2)',
                    display:'flex',alignItems:'center',justifyContent:'center',transition:'background .2s'}}>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <rect x="9" y="2" width="6" height="12" rx="3" fill={listening?'#fff':'#0A1628'}/>
              <path d="M5 11a7 7 0 0014 0" stroke={listening?'#fff':'#0A1628'} strokeWidth="2" strokeLinecap="round"/>
              <line x1="12" y1="18" x2="12" y2="22" stroke={listening?'#fff':'#0A1628'} strokeWidth="2" strokeLinecap="round"/>
              <line x1="8" y1="22" x2="16" y2="22" stroke={listening?'#fff':'#0A1628'} strokeWidth="2" strokeLinecap="round"/>
            </svg>
          </button>
          <button onClick={openNew}
            style={{background:'rgba(255,255,255,.15)',color:'#fff',border:'1px solid rgba(255,255,255,.3)',borderRadius:8,padding:'8px 12px',fontWeight:700,fontSize:12,minHeight:36}}>
            MANUAL
          </button>
        </div>
      </div>

      {/* â”€â”€ MAIN CONTENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
      <div style={{padding:'12px',maxWidth:900,margin:'0 auto'}}>

        {/* Current week stats */}
        <div style={{display:'flex',alignItems:'center',gap:8,marginBottom:8,flexWrap:'wrap'}}>
          <span style={{fontSize:10,fontWeight:700,color:'#6B87B0',letterSpacing:.8}}>WEEK Â· {currentWeek.label}</span>
          <DriverPill value={statsDriver} onChange={setStatsDriver}/>
        </div>
        <StatCards s={curStats}/>

        {/* Day sections */}
        <div style={{display:'flex',flexDirection:'column',gap:6}}>
          {curDays.map(day => (
            <DaySection key={day.dateStr} day={day}
              dayRides={rides.filter(r=>r.date===day.dateStr).sort((a,b)=>a.time.localeCompare(b.time))}
              isOpen={!!openDays[day.dateStr]}
              onToggle={()=>setOpenDays(p=>({...p,[day.dateStr]:!p[day.dateStr]}))}/>
          ))}
        </div>

        {/* Rolling totals */}
        <div style={{background:'#fff',borderRadius:10,overflow:'hidden',boxShadow:'0 1px 6px rgba(30,77,140,.08)',marginTop:8}}>
          <div onClick={()=>setRollingOpen(o=>!o)} style={{cursor:'pointer',
            background:'linear-gradient(135deg,#0A1628,#1E4D8C)',padding:'10px 14px',
            display:'flex',alignItems:'center',justifyContent:'space-between',minHeight:44}}>
            <span style={{fontWeight:700,fontSize:12,color:'#fff',letterSpacing:.8}}>ROLLING WEEK TOTALS</span>
            <div onClick={e=>e.stopPropagation()}>
              <DriverPill value={rollingDriver} onChange={setRollingDriver} light/>
            </div>
          </div>
          {rollingOpen && <RollingTable days={curDays} driver={rollingDriver}/>}
        </div>

        {/* Week history */}
        <div style={{marginTop:8}}>
          <div onClick={()=>setHistOpen(o=>!o)} style={{cursor:'pointer',minHeight:44,padding:'10px 14px',
            background:'linear-gradient(135deg,#1A2A40,#2D4A7A)',
            borderRadius:histOpen?'10px 10px 0 0':10,
            display:'flex',alignItems:'center',justifyContent:'space-between',
            boxShadow:'0 1px 6px rgba(30,77,140,.12)'}}>
            <span style={{fontWeight:700,fontSize:13,color:'#fff',letterSpacing:1}}>WEEK HISTORY</span>
            <div style={{display:'flex',alignItems:'center',gap:8}}>
              <div onClick={e=>e.stopPropagation()} style={{position:'relative',display:'inline-flex',alignItems:'center'}}>
                <select value={histWeekStr} onChange={e=>{setHistWeekStr(e.target.value);setHistOpenDays({});}}
                  style={{border:'none',borderRadius:6,padding:'3px 22px 3px 8px',fontSize:11,color:'#0A1628',background:'#fff',maxWidth:160}}>
                  {pastWeeks.map(w=><option key={w.sunStr} value={w.sunStr}>{w.label}</option>)}
                </select>
                <span style={{position:'absolute',right:5,pointerEvents:'none',fontSize:9,color:'#1E4D8C'}}>â–¼</span>
              </div>
              <span style={{color:'rgba(255,255,255,.6)',fontSize:11}}>{histOpen?'â–²':'â–¼'}</span>
            </div>
          </div>

          {histOpen && (
            <div style={{background:'#E8EDF5',borderRadius:'0 0 10px 10px',padding:'12px'}}>
              <div style={{display:'flex',alignItems:'center',gap:8,marginBottom:8,flexWrap:'wrap'}}>
                <span style={{fontSize:10,fontWeight:700,color:'#6B87B0',letterSpacing:.8}}>WEEK Â· {histWeek.label}</span>
                <DriverPill value={histDriver} onChange={setHistDriver}/>
              </div>
              <StatCards s={histStats}/>
              <div style={{display:'flex',flexDirection:'column',gap:6,marginBottom:8}}>
                {histDays.map(day=>(
                  <DaySection key={day.dateStr} day={day}
                    dayRides={rides.filter(r=>r.date===day.dateStr).sort((a,b)=>a.time.localeCompare(b.time))}
                    isOpen={!!histOpenDays[day.dateStr]}
                    onToggle={()=>setHistOpenDays(p=>({...p,[day.dateStr]:!p[day.dateStr]}))}/>
                ))}
              </div>
              <div style={{background:'#fff',borderRadius:8,overflow:'hidden',boxShadow:'0 1px 4px rgba(30,77,140,.07)'}}>
                <div onClick={()=>setHistRolOpen(o=>!o)} style={{cursor:'pointer',
                  background:'linear-gradient(135deg,#2D3A52,#4A6A9C)',padding:'10px 14px',
                  display:'flex',alignItems:'center',justifyContent:'space-between',minHeight:40}}>
                  <span style={{fontWeight:700,fontSize:11,color:'#fff',letterSpacing:.8}}>ROLLING WEEK TOTALS</span>
                  <div onClick={e=>e.stopPropagation()}>
                    <DriverPill value={histRolDriver} onChange={setHistRolDriver} light/>
                  </div>
                </div>
                {histRolOpen && <RollingTable days={histDays} driver={histRolDriver}/>}
              </div>
            </div>
          )}
        </div>
      </div>

      {/* â”€â”€ BOOK / EDIT MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
      {showModal && (
        <div onClick={()=>setShowModal(false)}
          style={{position:'fixed',inset:0,background:'rgba(10,22,40,.65)',display:'flex',alignItems:'flex-end',justifyContent:'center',zIndex:200,animation:'fadeIn .15s ease'}}>
          <div onClick={e=>e.stopPropagation()}
            style={{background:'#fff',borderRadius:'16px 16px 0 0',width:'100%',maxWidth:600,
                    boxShadow:'0 -4px 30px rgba(10,22,40,.3)',animation:'slideUp .2s ease',
                    maxHeight:'90vh',display:'flex',flexDirection:'column'}}>

            {/* Modal header */}
            <div style={{background:'linear-gradient(135deg,#0A1628,#1E4D8C)',padding:'16px 20px',
                         display:'flex',justifyContent:'space-between',alignItems:'center',borderRadius:'16px 16px 0 0',flexShrink:0}}>
              <div style={{fontSize:16,fontWeight:700,color:'#fff',letterSpacing:1}}>{editId ? 'EDIT RIDE' : 'BOOK NEW RIDE'}</div>
              <button onClick={()=>setShowModal(false)}
                style={{background:'rgba(255,255,255,.15)',color:'#fff',width:30,height:30,borderRadius:'50%',fontSize:16,display:'flex',alignItems:'center',justifyContent:'center'}}>âœ•</button>
            </div>

            {/* Modal body */}
            <div style={{padding:'20px',display:'flex',flexDirection:'column',gap:14,overflowY:'auto',flex:1}}>

              {/* Pickup â€” always shown */}
              <div>
                <label style={S.label}>Pickup Address *</label>
                <input autoFocus value={form.pickup} onChange={e=>setForm(f=>({...f,pickup:e.target.value}))}
                  placeholder="e.g. Bangor International Airport" style={S.input}/>
              </div>

              {/* New ride: expand button OR extra fields */}
              {!editId && !showExtra && (
                <button onClick={()=>setShowExtra(true)}
                  style={{...S.btn('#F0F6FF','#1E4D8C'),border:'1px solid #D1DEFA',fontSize:14}}>
                  + Add Driver, Dropoff, Fare & More
                </button>
              )}

              {(editId || showExtra) && (
                <>
                  <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
                    <div>
                      <label style={S.label}>Date</label>
                      <input type="date" value={form.date} onChange={e=>setForm(f=>({...f,date:e.target.value}))} style={S.input}/>
                    </div>
                    <div>
                      <label style={S.label}>Time</label>
                      <input type="time" value={form.time} onChange={e=>setForm(f=>({...f,time:e.target.value}))} style={S.input}/>
                    </div>
                  </div>

                  <div>
                    <label style={S.label}>Dropoff Address</label>
                    <input value={form.dropoff} onChange={e=>setForm(f=>({...f,dropoff:e.target.value}))}
                      placeholder="e.g. Brewer, ME" style={S.input}/>
                  </div>

                  <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
                    <div>
                      <label style={S.label}>Driver</label>
                      <div style={{position:'relative'}}>
                        <select value={form.driver} onChange={e=>setForm(f=>({...f,driver:e.target.value}))}
                          style={{...S.input,paddingRight:36,color:form.driver?'#0A1628':'#9FB4D0'}}>
                          <option value=''>Unassigned</option>
                          {drivers.active.map(d=><option key={d}>{d}</option>)}
                        </select>
                        <span style={{position:'absolute',right:12,top:'50%',transform:'translateY(-50%)',pointerEvents:'none',color:'#1E4D8C',fontSize:11}}>â–¼</span>
                      </div>
                    </div>
                    <div>
                      <label style={S.label}>Fare ($)</label>
                      <input type="number" step="0.01" min="0" value={form.fare} onChange={e=>setForm(f=>({...f,fare:e.target.value}))} style={S.input}/>
                    </div>
                    <div>
                      <label style={S.label}>Charge ($)</label>
                      <input type="number" step="0.01" min="0" value={form.charge} onChange={e=>setForm(f=>({...f,charge:e.target.value}))} style={S.input}/>
                    </div>
                    <div>
                      <label style={S.label}>Tip ($)</label>
                      <input type="number" step="0.01" min="0" value={form.tip} onChange={e=>setForm(f=>({...f,tip:e.target.value}))} style={S.input}/>
                    </div>
                  </div>

                  <div>
                    <label style={S.label}>Details</label>
                    <textarea value={form.details} onChange={e=>setForm(f=>({...f,details:e.target.value}))}
                      placeholder="Notes, special instructionsâ€¦"
                      style={{...S.input,resize:'vertical',minHeight:72}}/>
                  </div>
                </>
              )}
            </div>

            {/* Modal footer */}
            <div style={{padding:'12px 20px 24px',display:'flex',gap:10,flexShrink:0}}>
              <button onClick={()=>setShowModal(false)} style={{...S.btn('#F0F4FB','#6B87B0'),flex:1}}>CANCEL</button>
              <button onClick={handleSave} style={{...S.btn('linear-gradient(135deg,#0A1628,#1E4D8C)','#fff'),flex:2}}>
                {editId ? 'SAVE CHANGES' : 'BOOK RIDE'}
              </button>
            </div>
          </div>
        </div>
      )}

      {/* â”€â”€ DELETE CONFIRM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
      {delConfirm && (
        <div onClick={()=>setDelConfirm(null)}
          style={{position:'fixed',inset:0,background:'rgba(10,22,40,.65)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:200,padding:20}}>
          <div onClick={e=>e.stopPropagation()}
            style={{background:'#fff',borderRadius:14,width:'100%',maxWidth:340,padding:'28px 24px',textAlign:'center',boxShadow:'0 20px 60px rgba(10,22,40,.35)'}}>
            <div style={{fontSize:36,marginBottom:12}}>ğŸ—‘</div>
            <div style={{fontSize:18,fontWeight:700,color:'#0A1628',marginBottom:8}}>Delete this ride?</div>
            <div style={{fontSize:14,color:'#6B87B0',marginBottom:24,lineHeight:1.5}}>This will be removed from Google Sheets.</div>
            <div style={{display:'flex',gap:10}}>
              <button onClick={()=>setDelConfirm(null)} style={{...S.btn('#F0F4FB','#6B87B0'),flex:1}}>CANCEL</button>
              <button onClick={()=>handleDelete(delConfirm)} style={{...S.btn('#991B1B','#fff'),flex:1}}>DELETE</button>
            </div>
          </div>
        </div>
      )}

      {/* â”€â”€ MANAGE DRIVERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
      {showDrivers && (
        <div onClick={()=>setShowDrivers(false)}
          style={{position:'fixed',inset:0,background:'rgba(10,22,40,.65)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:200,padding:20}}>
          <div onClick={e=>e.stopPropagation()}
            style={{background:'#fff',borderRadius:16,width:'100%',maxWidth:460,boxShadow:'0 20px 60px rgba(10,22,40,.35)',overflow:'hidden',maxHeight:'85vh',display:'flex',flexDirection:'column'}}>
            <div style={{background:'linear-gradient(135deg,#0A1628,#1E4D8C)',padding:'16px 20px',display:'flex',justifyContent:'space-between',alignItems:'center',flexShrink:0}}>
              <div style={{fontSize:16,fontWeight:700,color:'#fff',letterSpacing:1}}>MANAGE DRIVERS</div>
              <button onClick={()=>setShowDrivers(false)} style={{background:'rgba(255,255,255,.15)',color:'#fff',width:30,height:30,borderRadius:'50%',fontSize:16,display:'flex',alignItems:'center',justifyContent:'center'}}>âœ•</button>
            </div>
            <div style={{padding:'20px',overflowY:'auto',flex:1,display:'flex',flexDirection:'column',gap:16}}>
              {/* Add */}
              <div>
                <label style={S.label}>Add New Driver</label>
                <div style={{display:'flex',gap:10}}>
                  <input value={newName} onChange={e=>setNewName(e.target.value)}
                    onKeyPress={e=>e.key==='Enter'&&addDriver()}
                    placeholder="Driver name" style={{...S.input,flex:1}}/>
                  <button onClick={addDriver} style={{...S.btn('linear-gradient(135deg,#0A1628,#1E4D8C)','#fff'),padding:'0 20px',minWidth:70}}>ADD</button>
                </div>
              </div>
              {/* Active */}
              <div>
                <div style={{fontSize:11,fontWeight:700,color:'#0A1628',letterSpacing:.5,marginBottom:10,textTransform:'uppercase'}}>Active ({drivers.active.length})</div>
                {drivers.active.length === 0
                  ? <div style={{padding:14,background:'#F0F4FB',borderRadius:10,fontSize:13,color:'#6B87B0',textAlign:'center',fontStyle:'italic'}}>No active drivers</div>
                  : <div style={{display:'flex',flexDirection:'column',gap:8}}>
                      {drivers.active.map(d=>(
                        <div key={d} style={{display:'flex',alignItems:'center',justifyContent:'space-between',padding:'12px 14px',background:'#F9FBFF',borderRadius:10,border:'1px solid #EBF0FA',minHeight:48}}>
                          <span style={{fontSize:15,fontWeight:600,color:'#0A1628'}}>{d}</span>
                          <button onClick={()=>archiveDriver(d)}
                            style={{background:'#FFF8E6',color:'#B45309',borderRadius:8,padding:'7px 14px',fontSize:13,fontWeight:600,border:'none',minHeight:34}}>
                            Archive
                          </button>
                        </div>
                      ))}
                    </div>
                }
              </div>
              {/* Archived */}
              {drivers.archived.length > 0 && (
                <div>
                  <div style={{fontSize:11,fontWeight:700,color:'#6B87B0',letterSpacing:.5,marginBottom:10,textTransform:'uppercase'}}>Archived ({drivers.archived.length})</div>
                  <div style={{display:'flex',flexDirection:'column',gap:8}}>
                    {drivers.archived.map(d=>(
                      <div key={d} style={{display:'flex',alignItems:'center',justifyContent:'space-between',padding:'12px 14px',background:'#F5F7FB',borderRadius:10,border:'1px solid #E5E9F2',minHeight:48}}>
                        <span style={{fontSize:15,color:'#6B87B0',fontStyle:'italic'}}>{d}</span>
                        <button onClick={()=>restoreDriver(d)}
                          style={{background:'#EDFAF3',color:'#065F46',borderRadius:8,padding:'7px 14px',fontSize:13,fontWeight:600,border:'none',minHeight:34}}>
                          Restore
                        </button>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

      {/* â”€â”€ VOICE CONFIRM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
      {voiceResult && (
        <div style={{position:'fixed',inset:0,background:'rgba(10,22,40,.75)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:200,padding:20}}>
          <div style={{background:'#fff',borderRadius:16,width:'100%',maxWidth:420,padding:'24px',boxShadow:'0 20px 60px rgba(10,22,40,.4)'}}>
            <div style={{fontSize:16,fontWeight:700,color:'#0A1628',marginBottom:14}}>ğŸ¤ Heard this pickup?</div>
            <div style={{background:'#F0F6FF',borderRadius:10,padding:'14px',fontSize:15,color:'#0A1628',fontWeight:600,marginBottom:8}}>"{voiceResult.text}"</div>
            <div style={{fontSize:12,color:'#9FB4D0',marginBottom:20}}>ğŸ“… {voiceResult.date} Â· â° {voiceResult.time}</div>
            <div style={{display:'flex',gap:10}}>
              <button onClick={()=>setVoiceResult(null)} style={{...S.btn('#F0F4FB','#6B87B0'),flex:1,fontSize:13}}>RETRY</button>
              <button onClick={()=>{setVoiceResult(null);openEdit({...EMPTY_FORM,pickup:voiceResult.text,date:voiceResult.date,time:voiceResult.time,id:genId()});}}
                style={{...S.btn('#EBF2FF','#1E4D8C'),flex:1,fontSize:13}}>EDIT</button>
              <button onClick={confirmVoice} style={{...S.btn('linear-gradient(135deg,#0A1628,#1E4D8C)','#fff'),flex:1,fontSize:13}}>CONFIRM</button>
            </div>
          </div>
        </div>
      )}

      {/* â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
      {toast && (
        <div style={{position:'fixed',bottom:28,left:'50%',transform:'translateX(-50%)',
                     background:'#0A1628',color:'#fff',padding:'12px 20px',borderRadius:10,
                     fontSize:14,fontWeight:600,boxShadow:'0 4px 20px rgba(10,22,40,.4)',
                     zIndex:300,whiteSpace:'nowrap',animation:'toastIn .3s ease'}}>
          {toast}
        </div>
      )}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>

<script>
  const isPreview = location.hostname.includes('claudeusercontent.com') ||
                    location.hostname === 'localhost' || location.hostname === '127.0.0.1';
  if ('serviceWorker' in navigator && !isPreview) {
    navigator.serviceWorker.register('./sw.js').catch(()=>{});
  }
</script>
</body>
</html>
